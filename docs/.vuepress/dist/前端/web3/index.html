<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>web3.0 | 大青虫</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/assets/img/xiao.PNG">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.PNG">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="文档、笔记、博客">
    <meta rel="author" content="不爱吃青菜的大青虫">
    <meta rel="Keywords" content="vuepress介绍说明 不爱吃青菜的大青虫">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.PNG">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.497a3858.css" as="style"><link rel="preload" href="/assets/js/app.6c856068.js" as="script"><link rel="preload" href="/assets/js/15.dea97000.js" as="script"><link rel="preload" href="/assets/js/3.55438353.js" as="script"><link rel="preload" href="/assets/js/109.aeb58ddd.js" as="script"><link rel="preload" href="/assets/js/6.ff336aa3.js" as="script"><link rel="prefetch" href="/assets/js/1.54146c49.js"><link rel="prefetch" href="/assets/js/10.f2d02379.js"><link rel="prefetch" href="/assets/js/100.bbb0ecca.js"><link rel="prefetch" href="/assets/js/101.c4243a60.js"><link rel="prefetch" href="/assets/js/102.3473f160.js"><link rel="prefetch" href="/assets/js/103.31498811.js"><link rel="prefetch" href="/assets/js/104.bccd23cc.js"><link rel="prefetch" href="/assets/js/105.1436d53e.js"><link rel="prefetch" href="/assets/js/106.29f4cc89.js"><link rel="prefetch" href="/assets/js/107.6a6817a6.js"><link rel="prefetch" href="/assets/js/108.aab7cd3e.js"><link rel="prefetch" href="/assets/js/11.502ea543.js"><link rel="prefetch" href="/assets/js/110.929f0775.js"><link rel="prefetch" href="/assets/js/111.bf8df0ab.js"><link rel="prefetch" href="/assets/js/112.f5cac5d2.js"><link rel="prefetch" href="/assets/js/113.0c3a6f21.js"><link rel="prefetch" href="/assets/js/114.f69839c4.js"><link rel="prefetch" href="/assets/js/115.ce60771a.js"><link rel="prefetch" href="/assets/js/116.8904ca27.js"><link rel="prefetch" href="/assets/js/117.cce75cf0.js"><link rel="prefetch" href="/assets/js/118.e3a77f80.js"><link rel="prefetch" href="/assets/js/119.9bd28496.js"><link rel="prefetch" href="/assets/js/12.7f2c5135.js"><link rel="prefetch" href="/assets/js/120.d019383a.js"><link rel="prefetch" href="/assets/js/121.16c9183d.js"><link rel="prefetch" href="/assets/js/122.6fd7ef11.js"><link rel="prefetch" href="/assets/js/123.4f62bc1c.js"><link rel="prefetch" href="/assets/js/124.49077ff8.js"><link rel="prefetch" href="/assets/js/125.75a25a70.js"><link rel="prefetch" href="/assets/js/126.72cd07a3.js"><link rel="prefetch" href="/assets/js/127.52d1fcdd.js"><link rel="prefetch" href="/assets/js/128.f4b60dc5.js"><link rel="prefetch" href="/assets/js/129.b2555ed2.js"><link rel="prefetch" href="/assets/js/13.8c0ce79b.js"><link rel="prefetch" href="/assets/js/130.9e76e82f.js"><link rel="prefetch" href="/assets/js/131.f619d038.js"><link rel="prefetch" href="/assets/js/132.10bf5d73.js"><link rel="prefetch" href="/assets/js/133.3c961231.js"><link rel="prefetch" href="/assets/js/134.e8369d65.js"><link rel="prefetch" href="/assets/js/135.f84086f2.js"><link rel="prefetch" href="/assets/js/136.f8fd144f.js"><link rel="prefetch" href="/assets/js/137.93e46a9c.js"><link rel="prefetch" href="/assets/js/138.dab9a42a.js"><link rel="prefetch" href="/assets/js/139.3830099b.js"><link rel="prefetch" href="/assets/js/14.f2e17d24.js"><link rel="prefetch" href="/assets/js/140.c50b8f91.js"><link rel="prefetch" href="/assets/js/141.f395550f.js"><link rel="prefetch" href="/assets/js/142.de481ab2.js"><link rel="prefetch" href="/assets/js/143.9bc99737.js"><link rel="prefetch" href="/assets/js/144.a558eac0.js"><link rel="prefetch" href="/assets/js/145.64283a2b.js"><link rel="prefetch" href="/assets/js/146.d1976e3b.js"><link rel="prefetch" href="/assets/js/147.aec56df2.js"><link rel="prefetch" href="/assets/js/148.aa94991e.js"><link rel="prefetch" href="/assets/js/149.acd1d25b.js"><link rel="prefetch" href="/assets/js/150.5412b0cd.js"><link rel="prefetch" href="/assets/js/151.53e710cc.js"><link rel="prefetch" href="/assets/js/152.d6210f57.js"><link rel="prefetch" href="/assets/js/16.661cd8d2.js"><link rel="prefetch" href="/assets/js/17.3f02f1a0.js"><link rel="prefetch" href="/assets/js/18.4cbfec42.js"><link rel="prefetch" href="/assets/js/19.524dbd3f.js"><link rel="prefetch" href="/assets/js/20.bbbaea26.js"><link rel="prefetch" href="/assets/js/21.1b10f204.js"><link rel="prefetch" href="/assets/js/22.0af9ca20.js"><link rel="prefetch" href="/assets/js/23.37249122.js"><link rel="prefetch" href="/assets/js/24.4d21590c.js"><link rel="prefetch" href="/assets/js/25.851487bf.js"><link rel="prefetch" href="/assets/js/26.395583bf.js"><link rel="prefetch" href="/assets/js/27.d9440c22.js"><link rel="prefetch" href="/assets/js/28.33b2e183.js"><link rel="prefetch" href="/assets/js/29.6381fb70.js"><link rel="prefetch" href="/assets/js/30.a69706bb.js"><link rel="prefetch" href="/assets/js/31.31507de3.js"><link rel="prefetch" href="/assets/js/32.b0626e41.js"><link rel="prefetch" href="/assets/js/33.9298b2fc.js"><link rel="prefetch" href="/assets/js/34.55665e05.js"><link rel="prefetch" href="/assets/js/35.feab1adc.js"><link rel="prefetch" href="/assets/js/36.68612078.js"><link rel="prefetch" href="/assets/js/37.11db60fa.js"><link rel="prefetch" href="/assets/js/38.b07d6a44.js"><link rel="prefetch" href="/assets/js/39.e3c10e31.js"><link rel="prefetch" href="/assets/js/4.00cecd82.js"><link rel="prefetch" href="/assets/js/40.97a46e5e.js"><link rel="prefetch" href="/assets/js/41.91a0b5c6.js"><link rel="prefetch" href="/assets/js/42.edd54061.js"><link rel="prefetch" href="/assets/js/43.e79e0c85.js"><link rel="prefetch" href="/assets/js/44.6c8874c2.js"><link rel="prefetch" href="/assets/js/45.3e3e4b66.js"><link rel="prefetch" href="/assets/js/46.26933e0c.js"><link rel="prefetch" href="/assets/js/47.6902b7d6.js"><link rel="prefetch" href="/assets/js/48.2b315085.js"><link rel="prefetch" href="/assets/js/49.e89ec0d6.js"><link rel="prefetch" href="/assets/js/5.4ea1ceee.js"><link rel="prefetch" href="/assets/js/50.137667fd.js"><link rel="prefetch" href="/assets/js/51.b1befb20.js"><link rel="prefetch" href="/assets/js/52.adcdac19.js"><link rel="prefetch" href="/assets/js/53.1e41b292.js"><link rel="prefetch" href="/assets/js/54.4fb9a21f.js"><link rel="prefetch" href="/assets/js/55.3b7ea5cb.js"><link rel="prefetch" href="/assets/js/56.03ae384f.js"><link rel="prefetch" href="/assets/js/57.1c0433b3.js"><link rel="prefetch" href="/assets/js/58.9e95ab77.js"><link rel="prefetch" href="/assets/js/59.1e5789ae.js"><link rel="prefetch" href="/assets/js/60.b2e1e8b2.js"><link rel="prefetch" href="/assets/js/61.6ec09195.js"><link rel="prefetch" href="/assets/js/62.6f1c3b8e.js"><link rel="prefetch" href="/assets/js/63.f62cbfeb.js"><link rel="prefetch" href="/assets/js/64.fc04745a.js"><link rel="prefetch" href="/assets/js/65.0f365ff6.js"><link rel="prefetch" href="/assets/js/66.035b1247.js"><link rel="prefetch" href="/assets/js/67.86c92ea8.js"><link rel="prefetch" href="/assets/js/68.d1b0ede1.js"><link rel="prefetch" href="/assets/js/69.6dda08c5.js"><link rel="prefetch" href="/assets/js/7.a3d26d62.js"><link rel="prefetch" href="/assets/js/70.1902b06f.js"><link rel="prefetch" href="/assets/js/71.8f843f6e.js"><link rel="prefetch" href="/assets/js/72.dc3881cb.js"><link rel="prefetch" href="/assets/js/73.8d5cfbb8.js"><link rel="prefetch" href="/assets/js/74.5d9e273b.js"><link rel="prefetch" href="/assets/js/75.53a42ab8.js"><link rel="prefetch" href="/assets/js/76.9bee45a9.js"><link rel="prefetch" href="/assets/js/77.6acdc66e.js"><link rel="prefetch" href="/assets/js/78.9f17fed9.js"><link rel="prefetch" href="/assets/js/79.bb6a7f56.js"><link rel="prefetch" href="/assets/js/8.bd048d93.js"><link rel="prefetch" href="/assets/js/80.4014b79f.js"><link rel="prefetch" href="/assets/js/81.54ac8728.js"><link rel="prefetch" href="/assets/js/82.0f993630.js"><link rel="prefetch" href="/assets/js/83.b717476e.js"><link rel="prefetch" href="/assets/js/84.40b539e1.js"><link rel="prefetch" href="/assets/js/85.42928e78.js"><link rel="prefetch" href="/assets/js/86.2a8dec41.js"><link rel="prefetch" href="/assets/js/87.9f08a1b5.js"><link rel="prefetch" href="/assets/js/88.9117804a.js"><link rel="prefetch" href="/assets/js/89.4e5ac6ac.js"><link rel="prefetch" href="/assets/js/9.c213f5ee.js"><link rel="prefetch" href="/assets/js/90.aa9c0a29.js"><link rel="prefetch" href="/assets/js/91.09ecb78a.js"><link rel="prefetch" href="/assets/js/92.1e1376f7.js"><link rel="prefetch" href="/assets/js/93.3326101b.js"><link rel="prefetch" href="/assets/js/94.eaf10838.js"><link rel="prefetch" href="/assets/js/95.c547e73c.js"><link rel="prefetch" href="/assets/js/96.9218988c.js"><link rel="prefetch" href="/assets/js/97.aede8353.js"><link rel="prefetch" href="/assets/js/98.a0bc633b.js"><link rel="prefetch" href="/assets/js/99.29f18bdb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.497a3858.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="./assets/img/xiaosi.PNG" alt="大青虫" class="logo"> <span class="site-name can-hide">大青虫</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AIGC" class="dropdown-title"><span class="title">AIGC</span> <span class="arrow down"></span></button> <button type="button" aria-label="AIGC" class="mobile-dropdown-title"><span class="title">AIGC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AIGC/whisper/" class="nav-link">
  Whisper
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/ffmpeg/" class="nav-link">
  Ffmpeg
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/动画制作/" class="nav-link">
  动画制作
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/tts/" class="nav-link">
  Tts
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/" class="nav-link">
  AIGC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="case" class="dropdown-title"><span class="title">case</span> <span class="arrow down"></span></button> <button type="button" aria-label="case" class="mobile-dropdown-title"><span class="title">case</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/case/" class="nav-link">
  Case
</a></li><li class="dropdown-item"><!----> <a href="/case/threejsOne/" class="nav-link">
  Threejs One
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="note" class="dropdown-title"><span class="title">note</span> <span class="arrow down"></span></button> <button type="button" aria-label="note" class="mobile-dropdown-title"><span class="title">note</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  Note
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack/原理/" class="nav-link">
  原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/webpack/项目/" class="nav-link">
  项目
</a></li><li class="dropdown-item"><!----> <a href="/webpack/高级/" class="nav-link">
  高级
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/Angular/" class="nav-link">
  Angular
</a></li><li class="dropdown-item"><!----> <a href="/前端/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/Electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/前端/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/前端/JavaScript/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/前端/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/前端/ReactNative/" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/前端/study/" class="nav-link">
  Study
</a></li><li class="dropdown-item"><!----> <a href="/前端/THREEJS/" class="nav-link">
  THREEJS
</a></li><li class="dropdown-item"><!----> <a href="/前端/TypeScript/" class="nav-link">
  Type Script
</a></li><li class="dropdown-item"><!----> <a href="/前端/utils/" class="nav-link">
  Utils
</a></li><li class="dropdown-item"><!----> <a href="/前端/VUE/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/前端/web3/" class="nav-link">
  Web3
</a></li><li class="dropdown-item"><!----> <a href="/前端/" class="nav-link">
  前端
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/CICD/" class="nav-link">
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/后端/Crawlers/" class="nav-link">
  Crawlers
</a></li><li class="dropdown-item"><!----> <a href="/后端/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/后端/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/后端/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/后端/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/后端/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/后端/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/后端/nvm/" class="nav-link">
  Nvm
</a></li><li class="dropdown-item"><!----> <a href="/后端/Crawlers/puppteer/" class="nav-link">
  Puppteer
</a></li><li class="dropdown-item"><!----> <a href="/后端/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂项" class="dropdown-title"><span class="title">杂项</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂项" class="mobile-dropdown-title"><span class="title">杂项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/杂项/" class="nav-link">
  杂项
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/网络/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow down"></span></button> <button type="button" aria-label="面经" class="mobile-dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/面经/category/" class="nav-link">
  Category
</a></li><li class="dropdown-item"><!----> <a href="/面经/contribution/" class="nav-link">
  Contribution
</a></li><li class="dropdown-item"><!----> <a href="/面经/experience/" class="nav-link">
  Experience
</a></li><li class="dropdown-item"><!----> <a href="/面经/lib/" class="nav-link">
  Lib
</a></li><li class="dropdown-item"><!----> <a href="/面经/" class="nav-link">
  面经
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AIGC" class="dropdown-title"><span class="title">AIGC</span> <span class="arrow down"></span></button> <button type="button" aria-label="AIGC" class="mobile-dropdown-title"><span class="title">AIGC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AIGC/whisper/" class="nav-link">
  Whisper
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/ffmpeg/" class="nav-link">
  Ffmpeg
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/动画制作/" class="nav-link">
  动画制作
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/tts/" class="nav-link">
  Tts
</a></li><li class="dropdown-item"><!----> <a href="/AIGC/" class="nav-link">
  AIGC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="case" class="dropdown-title"><span class="title">case</span> <span class="arrow down"></span></button> <button type="button" aria-label="case" class="mobile-dropdown-title"><span class="title">case</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/case/" class="nav-link">
  Case
</a></li><li class="dropdown-item"><!----> <a href="/case/threejsOne/" class="nav-link">
  Threejs One
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="note" class="dropdown-title"><span class="title">note</span> <span class="arrow down"></span></button> <button type="button" aria-label="note" class="mobile-dropdown-title"><span class="title">note</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  Note
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack/原理/" class="nav-link">
  原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/webpack/项目/" class="nav-link">
  项目
</a></li><li class="dropdown-item"><!----> <a href="/webpack/高级/" class="nav-link">
  高级
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/Angular/" class="nav-link">
  Angular
</a></li><li class="dropdown-item"><!----> <a href="/前端/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/Electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/前端/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/前端/JavaScript/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/前端/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/前端/ReactNative/" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/前端/study/" class="nav-link">
  Study
</a></li><li class="dropdown-item"><!----> <a href="/前端/THREEJS/" class="nav-link">
  THREEJS
</a></li><li class="dropdown-item"><!----> <a href="/前端/TypeScript/" class="nav-link">
  Type Script
</a></li><li class="dropdown-item"><!----> <a href="/前端/utils/" class="nav-link">
  Utils
</a></li><li class="dropdown-item"><!----> <a href="/前端/VUE/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/前端/web3/" class="nav-link">
  Web3
</a></li><li class="dropdown-item"><!----> <a href="/前端/" class="nav-link">
  前端
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/CICD/" class="nav-link">
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/后端/Crawlers/" class="nav-link">
  Crawlers
</a></li><li class="dropdown-item"><!----> <a href="/后端/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/后端/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/后端/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/后端/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/后端/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/后端/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/后端/nvm/" class="nav-link">
  Nvm
</a></li><li class="dropdown-item"><!----> <a href="/后端/Crawlers/puppteer/" class="nav-link">
  Puppteer
</a></li><li class="dropdown-item"><!----> <a href="/后端/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂项" class="dropdown-title"><span class="title">杂项</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂项" class="mobile-dropdown-title"><span class="title">杂项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/杂项/" class="nav-link">
  杂项
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/网络/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow down"></span></button> <button type="button" aria-label="面经" class="mobile-dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/面经/category/" class="nav-link">
  Category
</a></li><li class="dropdown-item"><!----> <a href="/面经/contribution/" class="nav-link">
  Contribution
</a></li><li class="dropdown-item"><!----> <a href="/面经/experience/" class="nav-link">
  Experience
</a></li><li class="dropdown-item"><!----> <a href="/面经/lib/" class="nav-link">
  Lib
</a></li><li class="dropdown-item"><!----> <a href="/面经/" class="nav-link">
  面经
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web3</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/web3/" aria-current="page" class="active sidebar-link">web3.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#web3-0" class="sidebar-link">web3.0</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#web3-0-对比2-0" class="sidebar-link">web3.0 对比2.0</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#metamask" class="sidebar-link">MetaMask</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#ganache" class="sidebar-link">Ganache</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#web3-js" class="sidebar-link">web3.js</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#编写智能合约" class="sidebar-link">编写智能合约</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/web3/#react-框架整合" class="sidebar-link">React 框架整合</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="web3-0"><a href="#web3-0" class="header-anchor">#</a> web3.0</h2> <h3 id="智能合约"><a href="#智能合约" class="header-anchor">#</a> 智能合约：</h3> <ol><li><p>太坊官网，包括了：教程和文档，以及示例游戏 https://ethereum.org/zh/developers/docs/</p></li> <li><p>站视频教程，建议选定一个，从头到尾看完。https://search.bilibili.com/all?keyword=%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%20%E6%95%99%E7%A8%8B&amp;from_source=webtop_search&amp;spm_id_from=333.1007&amp;search_source=5</p></li> <li><p>gGithub项目：Krypt  真枪实弹:第一个Web3项目【上集】用React.js,Solidity,智能合约构建最新区块链应用详细教程</p></li> <li><p>社区：WTF，开源免费  https://wtf.academy/</p></li></ol> <h2 id="web3-0-对比2-0"><a href="#web3-0-对比2-0" class="header-anchor">#</a> web3.0 对比2.0</h2> <p>去中心化 ：</p> <p>可追溯 不可更改 统一账号地址</p> <h2 id="metamask"><a href="#metamask" class="header-anchor">#</a> MetaMask</h2> <ol><li><p>MetaMask是一个浏览器插件，可作为MetaMask Chrome扩展或Firefox附加组件使用。它的核心是它作为以太坊钱包:通过安装它，您将可以访问一个独特的以太坊钱包地址，您可以使用它开始发送和接收以太币或ERC20通证</p></li> <li><p>但MetaMask不仅仅是以太坊钱包，作为浏览器扩展，它可以与您正在浏览的当前网页进行交互。它通过在您访河的每个网页中注入一个名为web3.js的JavaScript库来实现。注入后，web3将通过window.web3的JavaScript代码为你访问的每个网页提供一个对象。（新版本中转账不再需要交互）</p> <p>book alarm moment fever addict issue mind review banner hover story purse</p></li></ol> <h2 id="ganache"><a href="#ganache" class="header-anchor">#</a> Ganache</h2> <p>https://trufflesuite.com/ganache/</p> <p>Ganache 是一个用与本地开发的区块链，用于在以太坊区块链上开发去中心化的应用程序。Ganache 模拟了以太坊网络，你可以在发布到生产环境之前看到你的 DApp 将如何执行所以我们需要通过 ganache 来帮我们模拟一个以太坊的节点。测试通过后可以直接切换使用真实的以太坊的账号和区块节点就可以了</p> <p>cnpm i ganache -g</p> <p>启动 ： ganache</p> <p>启动 ： ganache -d 保持账号不变</p> <h2 id="web3-js"><a href="#web3-js" class="header-anchor">#</a> web3.js</h2> <p>github  ： https://github.com/web3/web3.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>登链社区 - 开发者最喜欢的区块链技术社区  ：  https://learnblockchain.cn/</p> <p>web3 社区文档 ：https://learnblockchain.cn/docs/web3.js/</p> <p>官方文档 ： https://web3js.readthedocs.io/en/v1.8.2/</p> <p>例子 ： index.html</p> <h2 id="编写智能合约"><a href="#编写智能合约" class="header-anchor">#</a> 编写智能合约</h2> <ol><li>Remix IDE</li></ol> <p>RemixIDE是开发以太坊能合约的在线IDE工具，部署简单的智能合约非常方便Remix地tt: https://remix.ethereum.org/</p> <ol start="2"><li>Truffle</li></ol> <p>Truffle是一个世界级的智能合约开发框架，专门为智能合约而生</p> <ul><li><p>管理智能合约的生命周期</p></li> <li><p>自动化合约测试</p></li> <li><p>可编程，可部署，可发布合约</p></li> <li><p>不用过多的关注网络管理</p></li> <li><p>强大的交互式控制台</p></li></ul> <p>安装  ：  cnpm install -g truffle</p> <p>初始化一个 truffle 项目时，它会创建运行一个完整 dapp 所有必要的文件 truffle xxx</p> <ul><li><p>build 放编译文件 truffle compile 生成文件</p></li> <li><p>contracts 编写合约</p></li> <li><p>migrations 部署文件  部署文件以数字开头命名</p></li></ul> <p>下面这个简单的例子包括了  solidity 简单编写  、 简单语法  、 编译以及部署</p> <p><em>/code/contracts/StudentStorage.sol</em></p> <div class="language-sol extra-class"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>

<span class="token comment">// 源码遵循协议，MIT...</span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.16</span> <span class="token operator">&lt;</span> <span class="token number">0.9</span><span class="token number">.0</span> <span class="token punctuation">;</span><span class="token comment">// 限定solidity编译器版本 </span>



<span class="token keyword">contract</span> <span class="token class-name">StudentStorage</span><span class="token punctuation">{</span>



​    <span class="token comment">// 创建 两个变量 user,age    // 默认为storage 存在链上的 </span>

​    <span class="token builtin">uint</span> age <span class="token punctuation">;</span> <span class="token comment">//  能存2的256次方   // uint8 // 2的8次方 能存0-255</span>

​    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token punctuation">;</span>  <span class="token comment">//obj.name()</span>





​    <span class="token comment">// external</span>

​    <span class="token comment">// ·外部函数是合约接口的一部分，这意味着可以从其他合约或通过事务调用它们。但是内部无法调用</span>

​    <span class="token comment">// public</span>

​    <span class="token comment">// 外部调用和内部都可以调用</span>

​    <span class="token comment">// internal</span>

​    <span class="token comment">// ·只能从当前合约或从当前合约派生的合约中访问，外部无法访问它们，由于它们没有通过合约的 </span>

​    <span class="token comment">// ABI向外部公开，所以它们可以接受内部类型的参数，比如映射或存储引用。</span>

​    <span class="token comment">// private</span>

​    <span class="token comment">// .私有函数类似于内部函数，但它们在派生合约中不可见。 </span>



​    <span class="token comment">// 3.Solidity语言</span>

​    <span class="token comment">// 3-1数据位置</span>

​    <span class="token comment">// solidity数据存储位置有三类: storage，memory和calldata。不同存储位置的gas成本不同storage类型的数推存在链上，</span>

​    <span class="token comment">// 类似计算机的硬盘，消耗gas多;memory和calldata类型的临时存在内存里，消耗gas少。大致用法：</span>

​    <span class="token comment">// 1，storage:合约里的状态变量默认都是storage，存储在链上。 // 存在链上 需要花费gas</span>

​    <span class="token comment">// 2，memory:函数里的参数和临时变量一般用memory，存储在内存中，不上链  // 临时变量  不需要花费gas   </span>

​    <span class="token comment">// 3，calldata: 和memory类似，存储在内存中，不上链。与memory的不同点在于calldata变量不能修改(immutable)，一般用于函数的参数</span>



​    <span class="token comment">// struct ,动态数组，映射，string   修改状态 就不能写 view pure</span>

​    <span class="token keyword">function</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> _name <span class="token punctuation">,</span><span class="token builtin">uint</span> _age <span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>

​        name <span class="token operator">=</span> _name <span class="token punctuation">;</span>

​        age  <span class="token operator">=</span> _age<span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>



​    <span class="token comment">// function test(uint x,uint y) public pure returns (uint){</span>

​    <span class="token comment">//     return x+y ;</span>

​    <span class="token comment">// }</span>

​    <span class="token comment">// view(视图函数，只访问不修改 状态) ，pure(纯函数， 不访问，也不修改)  节省gas</span>

​    <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> <span class="token punctuation">,</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

​        <span class="token keyword">return</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>



​    <span class="token comment">// 3-2 作用域</span>

​    <span class="token comment">// 变量的作用域: Solidity中变量按作用域划分有三种，分别是状态变量 (state variable)，局部变量(localvariable)和全局变量(globalvariable)。</span>

​    <span class="token comment">// 1. 状态变量:状态变量是数据存储在链上的变量，所有合约内函数都可以访问，gas消耗高。状态变量在合约内、函数外声明。可以在函数里更改状态变量的值!</span>

​    <span class="token comment">// 2. 局部变量:局部变量是仅在函数执行过程中有效的变量，函数退出后，变量无效。局部变量的数据存储在内存里，不上链，gas低。局部变量在函数内声明。</span>

​    <span class="token comment">// 3. 全局变量:全局变量是全局范围工作的变量，都是soliditv预留关键字。他们可以在函数内不声明直接使用(类似于msg.sender,block.number)</span>



​    <span class="token comment">// truffle compile  // 编译  可以检测一些错误 </span>



​    <span class="token comment">//truffle migrate  // 编译并部署 会先执行truffle compile  // 如果已经部署过了 则会跳过 ，需要--reset 才能强制重新部署</span>



​    <span class="token comment">//  truffle console 调试   </span>



​    <span class="token comment">// 输入  ： const obj  = await StudentStorage.deployed()</span>



​    <span class="token comment">// 查看链上地址 ： obj.address   // 调用里面的方法 obj.setData('kevin',100)   obj.getData()</span>

<span class="token punctuation">}</span>
</code></pre></div><p>部署文件  ：</p> <p><em>/code/migrations/1_deploy.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 部署 </span>

<span class="token keyword">const</span> Contacts <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;StudentStorage.sol&quot;</span><span class="token punctuation">)</span>



module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deployer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

​    deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>Contacts<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

\<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>`



 执行编译部署 ：  truffle migrate <span class="token operator">--</span>reset

<span class="token operator">**</span>### web3 一些简单api的应用例子<span class="token operator">**</span> 
</code></pre></div><p>​</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toAccout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>转账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

​        <span class="token keyword">var</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>Web3<span class="token punctuation">.</span>givenProvider <span class="token operator">||</span> <span class="token string">&quot;ws://localhost:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token comment">//  返回当前区块号。</span>

​        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBlockNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@返回当前区块号:'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>

​        <span class="token punctuation">}</span><span class="token punctuation">)</span>

​        <span class="token comment">// 返回当前所连接节点的链 ID。</span>

​        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getChainId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@返回当前所连接节点的链ID:'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>

​        <span class="token punctuation">}</span><span class="token punctuation">)</span>

​        <span class="token comment">// 返回地址在指定区块的余额。</span>

​        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token string">'0x8395b80508Ea1e89d3ac12Cc5F0ad849F693268D'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@返回地址在指定区块的余额:(默认单位为wei *18位)，  '</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;转换为ether ，&quot;</span><span class="token punctuation">,</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

​            <span class="token comment">// js只能算 2*-53  到 2*53+1  ， </span>

​            <span class="token comment">// 有bigInt  超大数值的运算  new BigNumber()  但浮点数超过20位 仍然会出错  ，   </span>

​            <span class="token comment">// 综上  ， 我们推荐让账号余额 以wei为单位 ， 仅在需要向用户展示才转换为其他单位</span>

​             <span class="token comment">//  0.1 + 0.2  在js中的计算  (0.1*1000 + 0.2*1000 )/1000   , wei单位的计算也差不多  </span>

​        <span class="token punctuation">}</span><span class="token punctuation">)</span>

​        <span class="token comment">//  将交易发送到网络  转账</span>

​        <span class="token comment">// web3.eth.sendTransaction({</span>

​        <span class="token comment">//     from:&quot;0x8395b80508Ea1e89d3ac12Cc5F0ad849F693268D&quot;,</span>

​        <span class="token comment">//     to:&quot;0xD7Dc4BA778092Ec93d2FFBbd658c4A755A8FD24b&quot;,</span>

​        <span class="token comment">//     value:web3.utils.toWei('1','ether')</span>

​        <span class="token comment">// }).then(reject=&gt;{</span>

​        <span class="token comment">//     console.log(&quot;交易&quot;,reject)</span>

​        <span class="token comment">// })</span>



​        <span class="token comment">// 授权 ： (新版本不再需要小狐狸交互授权) // 至少内网链不用</span>

​        <span class="token comment">// web3.eth.requestAccounts().then(res=&gt;{</span>

​        <span class="token comment">//     console.log(&quot;授权账号 ： &quot;,res)</span>

​        <span class="token comment">// })</span>

​        

​        <span class="token comment">//  获取账号  返回节点所控制的账户列表。</span>

​        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;@返回节点所控制的账户列表。&quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>



​            title<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'账号:'</span><span class="token operator">+</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  

​        <span class="token punctuation">}</span><span class="token punctuation">)</span>



​        <span class="token comment">// 交互转账 </span>

​        send<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;dddd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​            web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>

​                from<span class="token operator">:</span>title<span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span>

​                to<span class="token operator">:</span>toAccout<span class="token punctuation">.</span>value<span class="token punctuation">,</span>

​                value<span class="token operator">:</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'ether'</span><span class="token punctuation">)</span>

​            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reject</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>

​                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;转完了&quot;</span><span class="token punctuation">)</span>

​            <span class="token punctuation">}</span><span class="token punctuation">)</span>

​        <span class="token punctuation">}</span>



   </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="连接智能合约的例子"><a href="#连接智能合约的例子" class="header-anchor">#</a> 连接智能合约的例子</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>



​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

​    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

​        <span class="token comment">// if (typeof window.ethereum !== 'undefined') {</span>

​        <span class="token comment">//     console.log('MetaMask is installed!');</span>

​        <span class="token comment">// }else{</span>

​        <span class="token comment">//     alert(&quot;MetaMask is not installed&quot;)</span>

​        <span class="token comment">// }</span>



​        <span class="token comment">// var web3 = new Web3(Web3.givenProvider || &quot;ws://localhost:8545&quot;);</span>

​        <span class="token comment">// 新版授权写法   </span>

​        <span class="token keyword">let</span> web3Provider<span class="token punctuation">;</span>

​        <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">'ethereum'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​            web3Provider <span class="token operator">=</span> window<span class="token punctuation">.</span>ethereum<span class="token punctuation">;</span>

​            <span class="token keyword">try</span> <span class="token punctuation">{</span>

​                <span class="token comment">// 请求用户授权</span>

​                <span class="token keyword">await</span> window<span class="token punctuation">.</span>ethereum<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

​                <span class="token comment">// 用户不授权时</span>

​                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;User denied account access&quot;</span><span class="token punctuation">)</span>

​            <span class="token punctuation">}</span>

​        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>web3<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 老版 MetaMask Legacy dapp browsers...</span>

​            web3Provider <span class="token operator">=</span> window<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>currentProvider<span class="token punctuation">;</span>

​        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;都不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​            web3Provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>HttpProvider</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8545'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token punctuation">}</span>

​        <span class="token keyword">let</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>web3Provider<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//web3就是你需要的web3实例</span>



​        <span class="token comment">// 先授权</span>

​        <span class="token comment">// let account = await web3.eth.requestAccounts()</span>

​        <span class="token comment">// console.log('account',account); </span>

​        <span class="token comment">// 请求用户授权 解决web3js无法直接唤起Meta Mask获取用户身份</span>

​        <span class="token comment">// const enable = await ethereum.enable();</span>

​        <span class="token comment">// console.log(enable,11)</span>



​        <span class="token comment">//  获取账号  返回节点所控制的账户列表。</span>

​        <span class="token keyword">let</span> accounts <span class="token operator">=</span> <span class="token keyword">await</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

​        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@accounts'</span><span class="token punctuation">,</span> accounts<span class="token punctuation">)</span><span class="token punctuation">;</span>





​        <span class="token comment">//     方法和结构，就像API所做的那样，只是在较低的级别上。 abi 以json格式存在  ，也就是build里面打包文件能够找到abi 以及adress</span>

​        <span class="token comment">// web3.eth.Contract(abi,address)  （在 build中abi 找到abi ， address）</span>

​        <span class="token comment">// 链接智能合约程序 </span>

​        <span class="token keyword">const</span> studentListStorage <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>

​            <span class="token punctuation">[</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StudentList&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span><span class="token punctuation">,</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>

​        <span class="token punctuation">}</span><span class="token punctuation">,</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;constant&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>

​    <span class="token punctuation">}</span><span class="token punctuation">,</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;constant&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>

​    <span class="token punctuation">}</span><span class="token punctuation">,</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;constant&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>

​    <span class="token punctuation">}</span><span class="token punctuation">,</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_name&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>

​        <span class="token punctuation">}</span><span class="token punctuation">,</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_age&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;addList&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nonpayable&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span>

​    <span class="token punctuation">}</span><span class="token punctuation">,</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getList&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;components&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​            <span class="token punctuation">{</span>

​              <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​            <span class="token punctuation">}</span><span class="token punctuation">,</span>

​            <span class="token punctuation">{</span>

​              <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>

​            <span class="token punctuation">}</span><span class="token punctuation">,</span>

​            <span class="token punctuation">{</span>

​              <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>

​              <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uint256&quot;</span>

​            <span class="token punctuation">}</span>

​          <span class="token punctuation">]</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;struct StudentListStorage.Student[]&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tuple[]&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;constant&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>

​    <span class="token punctuation">}</span><span class="token punctuation">,</span>

​    <span class="token punctuation">{</span>

​      <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getName&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

​        <span class="token punctuation">{</span>

​          <span class="token string">&quot;internalType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>

​          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>

​        <span class="token punctuation">}</span>

​      <span class="token punctuation">]</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;stateMutability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span>

​      <span class="token string">&quot;constant&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>

​    <span class="token punctuation">}</span>

  <span class="token punctuation">]</span>

​            <span class="token punctuation">,</span> <span class="token string">&quot;0xcAc27E10d1298f67878e82B1c26BfEEcC5514aA2&quot;</span><span class="token punctuation">)</span>



​        <span class="token comment">// console.log(&quot;@studentListStorage&quot;, studentListStorage);  // methods即是写的哪些方法  </span>



​        add<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myname<span class="token punctuation">.</span>value<span class="token punctuation">,</span> myage<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

​            <span class="token comment">// send 从哪个账户付gas</span>

​            <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> studentListStorage<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">addList</span><span class="token punctuation">(</span>myname<span class="token punctuation">.</span>value<span class="token punctuation">,</span> myage<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>

​                from<span class="token operator">:</span> accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

​            <span class="token punctuation">}</span><span class="token punctuation">)</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;添加结果&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>

​        <span class="token punctuation">}</span>



​        <span class="token comment">// 进入首页 ，获取列表 </span>

​        <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



​        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 

​             <span class="token comment">// 报错  原因可能是个别状态未设置public ，经查证age未设置 ，重新编译部署   重新部署又是新地址（重新部署了两次  所以一共有三个地址 ） ，</span>

​            <span class="token comment">//   getList能用 ，但addList报错 ：Error: Transaction has been reverted by the EVM:</span>

​            <span class="token comment">// 未解决 </span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;@studentListStorage&quot;</span><span class="token punctuation">,</span>studentListStorage<span class="token punctuation">)</span>

​            <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> studentListStorage<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

​            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;@getList&quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

​            list<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

​                &lt;li&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">---</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;

​            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

​            

​        <span class="token punctuation">}</span>

​    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="脚本测试"><a href="#脚本测试" class="header-anchor">#</a> 脚本测试</h3> <p>​    mocha测试  需要学习</p> <p>​    truffle脚本</p> <p>写一个truffle脚本   ./scripts/test.js :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  测试脚本 </span>



​    <span class="token comment">// console.log(1111);</span>



​    <span class="token keyword">const</span> studentStorage <span class="token operator">=</span> <span class="token keyword">await</span> Contacts<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



​    <span class="token keyword">await</span> studentStorage<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'kervin'</span> <span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>

​    <span class="token keyword">let</span> res <span class="token operator">=</span>  <span class="token keyword">await</span> studentStorage<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

​    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

​    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> studentStorage<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> studentStorage<span class="token punctuation">.</span><span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 未设置public  不能访问</span>

​    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>   


</code></pre></div><p><em><strong>*什么叫做代币?*</strong></em></p> <p>代币可以在以太坊中表示任何东西</p> <ul><li><p>在线平台中的信誉积分</p></li> <li><p>金融资产类似于公司股份的资产</p></li> <li><p>像美元一样的法定货币</p></li> <li><p>一盎司黄金</p></li> <li><p>及更多...</p></li></ul> <p><strong>ERC-20就是一套基于以太坊网络的标准代币发行协议。有了ERC-20，开发者们得以高效、可靠、低成本地创造专属自己项目的代币;我们甚至可以将ERC-20视为以大坊网络为早期区块链世界做出的最重要贡献</strong></p> <p>https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md</p> <p><strong>ERC-20的功能示例包括</strong>:</p> <p>将代币从一个帐户转到另一个帐户.</p> <p>获取帐户的当前代币余额</p> <p>获取网络上可用代币的总供应量</p> <p>批准一个帐户中一定的代币金额由第三方帐户使用</p> <h3 id="erc-20-发行一个kervintoken代币"><a href="#erc-20-发行一个kervintoken代币" class="header-anchor">#</a> ERC-20 发行一个kervinToken代币</h3> <ol><li>kervinToken</li></ol> <div class="language-sol extra-class"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>

<span class="token comment">// 源码遵循协议，MIT...</span>

<span class="token comment">// pragma solidity ^0.8.0;// 限定solidity编译器版本 </span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;openzeppelin-solidity/contracts/math/SafeMath.sol&quot;</span><span class="token punctuation">;</span>





<span class="token comment">// 对标以太坊币 写 一个kervin币</span>

<span class="token keyword">contract</span> <span class="token class-name">KervinToken</span><span class="token punctuation">{</span>



​    <span class="token comment">// 代币协议  https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md</span>

​    <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span> <span class="token comment">//为了uint256后面使用 sub ,add方法，扩展  // 引入SafeMath的时候 ，合约版本冲突 ，直接改了SafeMath源文件版本（不推荐）</span>

​    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KervinToken&quot;</span> <span class="token punctuation">;</span> <span class="token comment">// 代币名</span>

​    <span class="token builtin">string</span> <span class="token keyword">public</span> symbol <span class="token operator">=</span> <span class="token string">&quot;KWT&quot;</span> <span class="token punctuation">;</span>  <span class="token comment">// 代币符号</span>



​    <span class="token builtin">uint256</span> <span class="token keyword">public</span> decimals <span class="token operator">=</span> <span class="token number">18</span> <span class="token punctuation">;</span><span class="token comment">// 1kervintoken = 10 *decimals 代币单位</span>

​    <span class="token builtin">uint256</span> <span class="token keyword">public</span> totalSupply<span class="token punctuation">;</span>  <span class="token comment">// 代币总量 </span>



​    <span class="token comment">//mapping 类似键值对类型   没有object   事件/日志存储 永久存在链上</span>

​    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token keyword">public</span> balanceOf <span class="token punctuation">;</span>   <span class="token comment">// 存放某个账号有多少kervinToken币  相当于数据存储</span>



​    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">public</span> allowance <span class="token punctuation">;</span>  <span class="token comment">// 定额   哪个账号授权给交易所多少额度</span>



​    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

​        totalSupply <span class="token operator">=</span> <span class="token number">1000000</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">**</span> decimals<span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token comment">// 部署账号</span>

​        balanceOf<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> totalSupply <span class="token punctuation">;</span> <span class="token comment">//创建者拥有所有的代币</span>

​    <span class="token punctuation">}</span>

​    <span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> _from<span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

​    <span class="token keyword">event</span> <span class="token function">Approval</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> _owner<span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> _spender<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>



​    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> 

​    <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 转账</span>

​        <span class="token keyword">require</span><span class="token punctuation">(</span>_to<span class="token operator">!=</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

​        <span class="token function">_tranfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>

​    <span class="token keyword">function</span> <span class="token function">_tranfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> _from<span class="token punctuation">,</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _value<span class="token punctuation">)</span> 

​    <span class="token keyword">internal</span> <span class="token punctuation">{</span> <span class="token comment">// internal 内部调用 </span>

​        <span class="token keyword">require</span><span class="token punctuation">(</span>balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token operator">&gt;=</span>_value <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require(true) 继续执行 否则抛错                       </span>

​        

​        <span class="token comment">//从哪个账号发起的调用者</span>

​        balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span>  <span class="token operator">=</span> balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 从发起人余额哪里减去这笔钱</span>

​        balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">=</span> balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 被发起人添加这笔钱</span>



​        <span class="token comment">// 触发事件 记录交易功能</span>



​        <span class="token keyword">emit</span> <span class="token function">Transfer</span><span class="token punctuation">(</span>_from<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//// 协议要求必须触发</span>

​    <span class="token punctuation">}</span>



​    <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span> _spender<span class="token punctuation">,</span><span class="token builtin">uint256</span> _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span>

​    <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 委托转账</span>

​        <span class="token comment">// msg.sender 当前网页登陆的账号</span>

​        <span class="token comment">// _spender 第三方的交易所账户地址</span>

​        <span class="token comment">// _value 收取得钱数</span>

​        <span class="token keyword">require</span><span class="token punctuation">(</span>_spender<span class="token operator">!=</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 出错 gas会退回 报错   比 if else</span>



​        allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">=</span> _value<span class="token punctuation">;</span>  <span class="token comment">// msg.sneder账号授权 _spender交易所   ——value钱 </span>



​        <span class="token keyword">emit</span> <span class="token function">Approval</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _spender<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 协议要求必须触发</span>

​        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token punctuation">;</span>



​    <span class="token punctuation">}</span>

​    

​    <span class="token comment">// 被授权得交易所调用</span>

​    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> _from <span class="token punctuation">,</span><span class="token builtin">address</span> _to <span class="token punctuation">,</span><span class="token builtin">uint256</span> _value<span class="token punctuation">)</span>

​    <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span>

​        <span class="token comment">// _from 某个放款账号 </span>

​        <span class="token comment">// _to 收款账号</span>

​        <span class="token comment">// msg.sender </span>



​        <span class="token keyword">require</span><span class="token punctuation">(</span>balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token keyword">require</span><span class="token punctuation">(</span>allowance<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token operator">&gt;=</span>_value<span class="token punctuation">)</span><span class="token punctuation">;</span>



​        allowance<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> allowance<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>

​        balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token function">_tranfer</span><span class="token punctuation">(</span>_from<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

​        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>

   

​    <span class="token comment">// 自动生成getter方法（public 对外提供）</span>



​    <span class="token comment">// truffle 调试  </span>

​    

​    <span class="token comment">// truffle console   </span>

​    <span class="token comment">// const token =await  KervinToken.deployed() </span>

​    <span class="token comment">//  token.name()  token.symbol()  token.totalSupply()</span>

<span class="token punctuation">}</span>





<span class="token comment">// 代币协议  https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md</span>



<span class="token comment">// function name() public view returns (string)</span>

<span class="token comment">// function symbol() public view returns (string)</span>

<span class="token comment">// function decimals() public view returns (uint8)</span>

<span class="token comment">// function totalSupply() public view returns (uint256)</span>

<span class="token comment">// function balanceOf(address _owner) public view returns (uint256 balance)</span>

<span class="token comment">// function transfer(address _to, uint256 _value) public returns (bool success)</span>

<span class="token comment">// function transferFrom(address _from, address _to, uint256 _value) public returns (bool success)</span>

<span class="token comment">// function approve(address _spender, uint256 _value) public returns (bool success)</span>

<span class="token comment">// function allowance(address _owner, address _spender) public view returns (uint256 remaining)</span>

<span class="token comment">// event  (address indexed _from, address indexed _to, uint256 _value)</span>

<span class="token comment">// event Approval(address indexed _owner, address indexed _spender, uint256 _value)</span>


</code></pre></div><p>- 测试脚本</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> KervinToken <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'KervinToken.sol'</span><span class="token punctuation">)</span> 



<span class="token keyword">const</span> <span class="token function-variable function">fromWei</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">bn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​    <span class="token keyword">return</span> web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span>bn<span class="token punctuation">,</span><span class="token string">'ether'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">toWei</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​    <span class="token keyword">return</span> web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span>number<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ether'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>



module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 

​    <span class="token keyword">const</span> Kervintoken  <span class="token operator">=</span> <span class="token keyword">await</span> KervinToken<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



​    <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> Kervintoken<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">'0xB12Fbbd20452a2A202bF046F70e499F068cC569A'</span><span class="token punctuation">)</span>



​    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一个账号：'</span><span class="token punctuation">,</span><span class="token function">fromWei</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



​    <span class="token keyword">await</span> Kervintoken<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token string">&quot;0x04551dFAf0A90Bc44a8d597dBF05Ce0b5F64b607&quot;</span><span class="token punctuation">,</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>

​        from<span class="token operator">:</span><span class="token string">&quot;0xB12Fbbd20452a2A202bF046F70e499F068cC569A&quot;</span>

​    <span class="token punctuation">}</span><span class="token punctuation">)</span>

​    

​    <span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> Kervintoken<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">'0x04551dFAf0A90Bc44a8d597dBF05Ce0b5F64b607'</span><span class="token punctuation">)</span>



​    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二个账号：'</span><span class="token punctuation">,</span><span class="token function">fromWei</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



​    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>



<span class="token comment">// truffle exec .\script\test-tranfer.js</span>
</code></pre></div><ol start="2"><li>交易所</li></ol> <div class="language-sol extra-class"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>

<span class="token comment">// 源码遵循协议，MIT...</span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;openzeppelin-solidity/contracts/math/SafeMath.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./KervinToken.sol&quot;</span><span class="token punctuation">;</span>





<span class="token keyword">contract</span> <span class="token class-name">Exchange</span><span class="token punctuation">{</span>

​    <span class="token keyword">using</span> <span class="token class-name">SafeMath</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span> <span class="token comment">//为了uint256后面使用 sub ,add方法，扩展  // 引入SafeMath的时候 ，合约版本冲突 ，直接改了SafeMath源文件版本（不推荐）</span>



​    <span class="token comment">//收费账号地址 </span>

​    <span class="token builtin">address</span> <span class="token keyword">public</span> feeAccount <span class="token punctuation">;</span>

​    <span class="token builtin">uint256</span> <span class="token keyword">public</span> feePercent <span class="token punctuation">;</span> <span class="token comment">//费率 </span>

​    <span class="token builtin">address</span> <span class="token keyword">constant</span> ETHER <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span>

​    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokens <span class="token punctuation">;</span>  <span class="token comment">// </span>



​    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _feeAccount <span class="token punctuation">,</span><span class="token builtin">uint256</span> _feePercent<span class="token punctuation">)</span><span class="token punctuation">{</span>

​        feeAccount <span class="token operator">=</span> _feeAccount <span class="token punctuation">;</span>

​        feePercent <span class="token operator">=</span> _feePercent <span class="token punctuation">;</span> 

​    <span class="token punctuation">}</span>



​    <span class="token keyword">event</span> <span class="token function">Deposit</span><span class="token punctuation">(</span><span class="token builtin">address</span> token <span class="token punctuation">,</span> <span class="token builtin">address</span> user <span class="token punctuation">,</span><span class="token builtin">uint256</span> amount <span class="token punctuation">,</span><span class="token builtin">uint256</span> balance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 规定一个存款事件</span>

​    <span class="token comment">// 此mapping类似于 ： </span>

​    <span class="token comment">// {</span>

​    <span class="token comment">//     &quot;比特币地址&quot;:{ // 币的地址为key值 ，不容易搞错 ，相当于第一个address</span>

​    <span class="token comment">//         &quot;A用户&quot;:100,</span>

​    <span class="token comment">//         &quot;B用户&quot;:200,</span>

​    <span class="token comment">//     },</span>

​    <span class="token comment">//     &quot;KWT地址&quot;:{</span>

​    <span class="token comment">//         &quot;A用户&quot;:100,</span>

​    <span class="token comment">//         &quot;B用户&quot;:300,</span>

​    <span class="token comment">//     }</span>

​    <span class="token comment">// }</span>

​    <span class="token comment">// 类似于银行买理财产品 ， 需要先将这笔钱打到交易所 ，</span>

​    <span class="token comment">// 存以太币</span>

​    <span class="token keyword">function</span> <span class="token function">depositEther</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token keyword">public</span><span class="token punctuation">{</span>  <span class="token comment">// payable 方法 由以太坊提供</span>

​        <span class="token comment">// msg.sender</span>

​        <span class="token comment">// msg.value 拿到转到交易所的钱数</span>

​        <span class="token comment">// tokens[以太坊地址][mag.sender] = tokens[以太坊地址][mag.sender]</span>

​        <span class="token comment">// .add(msg.value)  // </span>

​        <span class="token comment">// ETHER 以太坊地址</span>

​        tokens<span class="token punctuation">[</span>ETHER<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> tokens<span class="token punctuation">[</span>ETHER<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span>

​        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>



​        <span class="token keyword">emit</span> <span class="token function">Deposit</span><span class="token punctuation">(</span>ETHER<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>ETHER<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>

​    <span class="token comment">// 存其他货币</span>

​    <span class="token keyword">function</span> <span class="token function">depositToken</span><span class="token punctuation">(</span><span class="token builtin">address</span> _token <span class="token punctuation">,</span><span class="token builtin">uint256</span> _amount<span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>

​        <span class="token comment">// 调用某个方法强行 从你账号往当前交易所账号转钱</span>

​       <span class="token keyword">require</span><span class="token punctuation">(</span>_token <span class="token operator">!=</span>  ETHER<span class="token punctuation">)</span><span class="token punctuation">;</span>

​       <span class="token keyword">require</span><span class="token punctuation">(</span> <span class="token function">KervinToken</span><span class="token punctuation">(</span>_token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



​        tokens<span class="token punctuation">[</span>_token<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> tokens<span class="token punctuation">[</span>_token<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>_amount<span class="token punctuation">)</span><span class="token punctuation">;</span>   



​        <span class="token keyword">emit</span> <span class="token function">Deposit</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_token<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _amount<span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>_token<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

​    <span class="token punctuation">}</span>




</code></pre></div><p>``` sol</p> <p><strong>存款测试</strong> 脚本</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> KervinToken <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'KervinToken.sol'</span><span class="token punctuation">)</span> 



<span class="token keyword">const</span> Exchange <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;Exchange.sol&quot;</span><span class="token punctuation">)</span>



<span class="token keyword">const</span> <span class="token constant">ETHER_ADDRESS</span> <span class="token operator">=</span> <span class="token string">'ox0000000000000000000000000000000000000'</span>

<span class="token comment">// 0x 后面 40个x</span>



<span class="token keyword">const</span> <span class="token function-variable function">fromWei</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">bn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​    <span class="token keyword">return</span> web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span>bn<span class="token punctuation">,</span><span class="token string">'ether'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">toWei</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

​    <span class="token keyword">return</span> web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span>number<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ether'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>



module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 

​    <span class="token keyword">const</span> kervintoken  <span class="token operator">=</span> <span class="token keyword">await</span> KervinToken<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

​    <span class="token keyword">const</span> exchange <span class="token operator">=</span><span class="token keyword">await</span> Exchange<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

​    <span class="token keyword">const</span> accounts <span class="token operator">=</span><span class="token keyword">await</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



​    <span class="token comment">// await exchange.depositEther({ // 测试委托转账测试 存以太币</span>

​    <span class="token comment">//     from: accounts[0], </span>

​    <span class="token comment">//     value:toWei(10)</span>

​    <span class="token comment">// })</span>

​    <span class="token comment">// let res = await exchange.tokens(ETHER_ADDRESS,accounts[0]) // bigNumber 类型</span>

​    <span class="token comment">// console.log(fromWei(res))</span>



​     

​    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>



<span class="token comment">// truffle exec .\script\test-tranfer.js</span>
</code></pre></div><h2 id="react-框架整合"><a href="#react-框架整合" class="header-anchor">#</a> React 框架整合</h2> <ol><li><p>创建react项目  create-react-app myapp</p></li> <li><p>改变truffle 生成build文件夹位置 ， 在truffle-config.js  :  &quot;contracts_build_directory&quot;:&quot;./src/build&quot;</p></li> <li><p>redux的使用： 使用@reduxjs/toolkit 的 configureStore \ createSlice（提供异步action） 配合react-redux 来使用redux 管理公共状态</p> <p>注意 ： create-react-app 创建的应用  ， react系列现在要全部cnpm 一遍更到最新 ，否则报错</p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2023年4月15日星期六 13:45</span></div></footer> <!----> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.6c856068.js" defer></script><script src="/assets/js/15.dea97000.js" defer></script><script src="/assets/js/3.55438353.js" defer></script><script src="/assets/js/109.aeb58ddd.js" defer></script><script src="/assets/js/6.ff336aa3.js" defer></script>
  </body>
</html>
